name: Test Syntax

on:
  workflow_dispatch:
    inputs:
      environment:
        description: Which environment to test?
        required: true
        type: choice
        default: staging
        options: [staging, production]

jobs:
  syntax:
    name: Validate config & contexts
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Test Variables and Secrets
        env:
          STAGING_URL: ${{ vars.STAGING_URL || 'https://staging.example.com' }}
          PRODUCTION_URL: ${{ vars.PRODUCTION_URL || 'https://example.com' }}
        run: |
          echo "=== Environment Configuration Test ==="
          echo "ENVIRONMENT_NAME: ${{ inputs.environment }}"
          
          # Set default values for variables that might not be defined
          N8N_ENABLED="${N8N_ENABLED:-false}"
          N8N_BASE_URL="${N8N_BASE_URL:-}"
          DEPLOYMENT_WEBHOOK_URL="${DEPLOYMENT_WEBHOOK_URL:-}"
          N8N_API_KEY="${N8N_API_KEY:-}"
          
          # Use environment variables with fallbacks
          STAGING_URL="${STAGING_URL:-https://staging.example.com}"
          PRODUCTION_URL="${PRODUCTION_URL:-https://example.com}"
          
          # Determine APP_URL based on environment
          if [ "${{ inputs.environment }}" = "production" ]; then
            APP_URL="$PRODUCTION_URL"
          else
            APP_URL="$STAGING_URL"
          fi
          echo "APP_URL: $APP_URL"
          
          echo "N8N_ENABLED: $N8N_ENABLED"
          echo "N8N_BASE_URL set? $([ -n "$N8N_BASE_URL" ] && echo "yes" || echo "no")"
          echo "DEPLOYMENT_WEBHOOK_URL set? $([ -n "$DEPLOYMENT_WEBHOOK_URL" ] && echo "yes" || echo "no")"
          echo "N8N_API_KEY set? $([ -n "$N8N_API_KEY" ] && echo "yes" || echo "no")"
          
          echo "=== Test Complete ==="
