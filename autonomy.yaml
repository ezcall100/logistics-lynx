# =============================================================================
# AUTONOMOUS OPERATING SYSTEM CONFIGURATION
# =============================================================================
# Single source of truth for all autonomous operations
# This file is read by the orchestrator on boot

# =============================================================================
# 1. SYSTEM MODE & OPERATION
# =============================================================================

mode: "FULL"                    # FULL | DEGRADED | EMERGENCY
kill_switch: false              # Global emergency stop
config_source: "Single source of truth for all autonomous operations"
status: "FULL AUTONOMOUS AUTHORITY GRANTED - 24/7 OPERATION ENABLED"

# =============================================================================
# 2. BUDGETS & SAFETY RAILS
# =============================================================================

budgets:
  agents:
    max_concurrent: 150         # Maximum concurrent agent tasks
    max_memory_mb: 2048         # Memory limit per agent
    max_cpu_percent: 80         # CPU limit per agent
  
  replay:
    per_5m: 3                   # Replays per 5 minutes per tenant/IP
    batch_max: 50               # Maximum batch size for DLQ replay
    payload_mb_max: 2           # Maximum payload size in MB
    failure_threshold: 20       # Stop replay if >20% fail immediately
  
  rate_limits:
    api_requests_per_minute: 1000
    webhook_requests_per_minute: 100
    database_queries_per_second: 100

# =============================================================================
# 3. SERVICE LEVEL OBJECTIVES (SLOs)
# =============================================================================

slos:
  uptime: 99.95                 # Minimum uptime percentage
  success_pct: 98               # Minimum success rate percentage
  p95_ms: 2500                  # p95 response time in milliseconds
  outbox_lag_p95_ms: 5000       # p95 outbox lag in milliseconds
  dlq_depth_max: 20             # Maximum DLQ depth before alerting

# =============================================================================
# 4. OPERATIONAL SCHEDULES
# =============================================================================

schedules:
  probe_s: 30                   # Health probe interval (seconds)
  replay_m: 5                   # DLQ replay interval (minutes)
  guardrails_h: 1               # Guardrail scan interval (hours)
  ttl_d: 1                      # TTL cleanup interval (days)
  dr_drill_w: 1                 # DR drill interval (weeks)
  key_rotation_m: 1             # Key rotation rehearsal (months)

# =============================================================================
# 5. PORTAL AUTHORITY (20 Canonical Portals)
# =============================================================================

portals:
  super_admin:
    autonomous: true
    roles: ["super_admin"]
    description: "Global system control and tenant provisioning"
  
  admin:
    autonomous: true
    roles: ["tenant_admin"]
    description: "User and role lifecycle management"
  
  tms_admin:
    autonomous: true
    roles: ["tenant_admin", "ops_manager"]
    description: "TMS configuration and equipment management"
  
  onboarding:
    autonomous: true
    roles: ["tenant_admin"]
    description: "Customer onboarding and data import"
  
  broker:
    autonomous: true
    roles: ["ops_manager", "dispatcher", "viewer"]
    description: "Broker operations and quote management"
  
  shipper:
    autonomous: true
    roles: ["ops_manager", "dispatcher", "viewer"]
    description: "Shipper self-service and booking"
  
  carrier:
    autonomous: true
    roles: ["ops_manager", "dispatcher", "viewer"]
    description: "Carrier operations and capacity management"
  
  driver:
    autonomous: true
    roles: ["driver", "viewer"]
    description: "Driver mobile app and status updates"
  
  owner_operator:
    autonomous: true
    roles: ["owner_operator"]
    description: "Business management and settlements"
  
  factoring:
    autonomous: true
    roles: ["finance_manager"]
    description: "Financial services and invoice processing"
  
  load_board:
    autonomous: true
    roles: ["ops_manager", "dispatcher", "viewer"]
    description: "Freight matching and load posting"
  
  crm:
    autonomous: true
    roles: ["ops_manager", "analyst"]
    description: "Customer relationship management"
  
  financials:
    autonomous: true
    roles: ["finance_manager", "analyst"]
    description: "Accounting and payment processing"
  
  edi:
    autonomous: true
    roles: ["ops_manager"]
    description: "Electronic data interchange"
  
  marketplace:
    autonomous: true
    roles: ["tenant_admin"]
    description: "App marketplace and integrations"
  
  analytics:
    autonomous: true
    roles: ["analyst", "viewer"]
    description: "Business intelligence and reporting"
  
  autonomous:
    autonomous: true
    roles: ["super_admin", "ops_manager"]
    description: "System operations and monitoring"
  
  workers:
    autonomous: true
    roles: ["ops_manager"]
    description: "Workforce management and scheduling"
  
  rates:
    autonomous: true
    roles: ["ops_manager", "analyst"]
    description: "Pricing and contract management"
  
  directory:
    autonomous: true
    roles: ["ops_manager", "analyst", "viewer"]
    description: "Partner management and KYC"

# =============================================================================
# 6. WEBSITE AUTHORITY (50 Pages)
# =============================================================================

website:
  content:
    autonomous: true
    description: "Content generation and management"
  
  seo:
    autonomous: true
    description: "Search engine optimization"
  
  images:
    autonomous: true
    description: "Image generation and optimization"
  
  structured_data:
    autonomous: true
    description: "Schema markup and metadata"
  
  analytics:
    autonomous: true
    description: "Website performance tracking"
  
  performance:
    autonomous: true
    description: "Load time optimization"
  
  accessibility:
    autonomous: true
    description: "Compliance and usability"
  
  mobile:
    autonomous: true
    description: "Mobile optimization"

# =============================================================================
# 7. SECURITY & COMPLIANCE
# =============================================================================

security:
  rls_enabled: true             # Row-level security
  jwt_enabled: true             # JWT token validation
  hmac_enabled: true            # HMAC v2 authentication
  idempotency_enabled: true     # Idempotency controls
  pii_redaction_enabled: true   # PII redaction in logs
  audit_enabled: true           # Comprehensive audit logging
  csp_enabled: true             # Content security policy
  cors_enabled: true            # CORS protection

# =============================================================================
# 8. MONITORING & OBSERVABILITY
# =============================================================================

monitoring:
  otel_enabled: true            # OpenTelemetry tracing
  metrics_enabled: true         # Metrics collection
  logging_enabled: true         # Structured logging
  alerting_enabled: true        # Alert notifications
  dashboard_enabled: true       # Real-time dashboard
  trace_exemplars_enabled: true # Trace exemplars for SLOs

# =============================================================================
# 9. INTEGRATIONS & WORKFLOWS
# =============================================================================

integrations:
  n8n_enabled: true             # n8n workflow integration
  stripe_enabled: true          # Stripe payment processing
  crm_enabled: true             # CRM integration
  edi_enabled: true             # EDI integration
  slack_enabled: true           # Slack notifications
  email_enabled: true           # Email notifications

workflows:
  autonomous_enabled: true      # Autonomous workflow execution
  approval_enabled: true        # Approval workflows
  escalation_enabled: true      # Escalation workflows
  notification_enabled: true    # Notification workflows

# =============================================================================
# 10. OPERATIONAL CONTROLS
# =============================================================================

operations:
  dlq_replay_enabled: true      # DLQ replay functionality
  outbox_enabled: true          # Event outbox processing
  auto_rollback_enabled: true   # Automatic rollback on failure
  canary_enabled: true          # Canary deployment
  health_checks_enabled: true   # Health check system
  slo_gates_enabled: true       # SLO-based gating

# =============================================================================
# 11. ANALYTICS & INSIGHTS
# =============================================================================

analytics:
  realtime_enabled: true        # Real-time analytics
  predictive_enabled: true      # Predictive analytics
  kpi_enabled: true             # KPI tracking
  funnel_enabled: true          # Funnel analysis
  slo_enabled: true             # SLO tracking
  exemplars_enabled: true       # Trace exemplars

# =============================================================================
# 12. EMERGENCY PROCEDURES
# =============================================================================

emergency:
  stop_command: "node emergency-stop.js stop"
  status_command: "node emergency-stop.js status"
  resume_command: "node emergency-stop.js resume"
  audit_trail: true             # Audit all emergency actions
  notification_channels: ["slack", "email"]
  escalation_timeout_minutes: 5

# =============================================================================
# 13. COMPLIANCE & AUDIT
# =============================================================================

compliance:
  audit_logging: true           # Comprehensive audit trail
  data_retention_days: 90       # Audit log retention
  pii_handling: "redacted"      # PII handling policy
  access_control: "rbac"        # Access control method
  encryption: "at_rest_and_transit" # Encryption standards

# =============================================================================
# 14. PERFORMANCE TARGETS
# =============================================================================

performance:
  target_uptime: 99.95          # Target uptime percentage
  target_response_time_p95: 2500 # Target p95 response time (ms)
  target_success_rate: 98       # Target success rate percentage
  target_outbox_lag_p95: 5000   # Target p95 outbox lag (ms)
  target_dlq_depth: 20          # Target maximum DLQ depth

# =============================================================================
# 15. DEPLOYMENT & CI/CD
# =============================================================================

deployment:
  auto_deploy: true             # Automatic deployment
  canary_deployment: true       # Canary deployment strategy
  rollback_on_failure: true     # Automatic rollback
  health_check_timeout: 300     # Health check timeout (seconds)
  deployment_timeout: 1800      # Deployment timeout (seconds)

# =============================================================================
# CONFIGURATION NOTES
# =============================================================================

# This configuration file serves as the single source of truth for the
# autonomous operating system. The orchestrator reads this file on boot
# and applies the configuration to the feature flags system.
#
# Key principles:
# - All settings are auditable and version-controlled
# - Changes require approval and testing
# - Emergency procedures are clearly defined
# - Safety rails are always active
# - Performance targets are measurable
#
# The system operates 24/7 with full autonomous authority while maintaining
# iron-clad guardrails and one-command emergency stop capability.
