{
  "version": "2.0.0",
  "last_updated": "2024-12-01T00:00:00.000Z",
  "platform": "transbot-ai",
  "operating_mode": "autonomous-24-7",
  "standing_order": "A-1",
  "golden_rules": {
    "flags_first": {
      "hierarchy": "global → env → tenant",
      "blocked_action": "no-op + FF_BLOCKED log",
      "never_bypass": true
    },
    "identity_scope": {
      "jwt_required": "role-based",
      "hmac_v2": "timestamp+nonce",
      "company_id": "all reads/writes"
    },
    "idempotency": {
      "check_before_external": "event/outbox keys",
      "dedupe": ["stripe", "edi_webhooks"],
      "window": "10-min"
    },
    "rls_safe": {
      "never_bypass": "outside service-role edge paths",
      "company_scoped": "all operations",
      "audit_trail": "all changes"
    },
    "durability": {
      "pattern": "write → commit → publish via Outbox",
      "failure": "DLQ (auto-snooze/backoff)",
      "circuit_break": "≥20% immediate fails"
    },
    "observability": {
      "root_span": "agent.task.execute",
      "function_spans": "agent.fn.<domain>.<action>",
      "error_recording": "with context",
      "trace_links": "in Slack"
    },
    "slo_gates": {
      "uptime": "≥99.95%",
      "success_rate": "≥98%",
      "p95_latency": "≤2.5s",
      "quarantine_rate": "<1%",
      "breach_action": "throttle, open incident, flip canaries off"
    }
  },
  "end_to_end_flows": [
    {
      "id": "quote_to_bill",
      "name": "Quote → Book → Bill",
      "start": ["roi_form", "broker_request", "api_edi_204"],
      "do": [
        "normalize",
        "price (rates.price_one)",
        "offer_tender (204)",
        "book (990 ack)",
        "track (214)",
        "pod_ocr",
        "invoice (210)",
        "ar_factoring"
      ],
      "finish": {
        "load": "closed",
        "invoice": "paid",
        "analytics": "written"
      },
      "fail": "DLQ + backoff; circuit-break lane if ≥20% immediate fails"
    },
    {
      "id": "carrier_onboard",
      "name": "Carrier Onboard → Live",
      "start": ["application", "kyc"],
      "do": [
        "docs_verify",
        "compliance_score",
        "integrations",
        "trial_load"
      ],
      "finish": {
        "carrier": "active",
        "lanes": "enabled"
      }
    },
    {
      "id": "exception_remediate",
      "name": "Exception → Auto-Remediate",
      "start": ["sla_anomaly", "eta_anomaly"],
      "do": [
        "classify",
        "re_tender",
        "re_route",
        "re_price",
        "notify"
      ],
      "finish": {
        "exception_resolution": "success",
        "fallback": "quarantine + alert"
      }
    },
    {
      "id": "dr_failover",
      "name": "DR / Multi-Region",
      "start": "health_gate_fail_3x_30s",
      "do": [
        "flip_region_flag",
        "drain",
        "replay_outbox"
      ],
      "finish": {
        "secondary": "green",
        "incident": "posted"
      }
    }
  ],
  "portal_tasks": {
    "super_admin": {
      "start": "config_change",
      "do": ["companies", "flags", "audit"],
      "finish": "change audited + propagated"
    },
    "admin": {
      "start": "invite_role_key",
      "do": ["profiles", "roles", "api_keys"],
      "finish": "auth passes, keys rotated"
    },
    "tms_admin": {
      "start": "lane_contract_guardrail",
      "do": ["lanes", "contracts", "pricing_guards"],
      "finish": "guardrails enforced"
    },
    "onboarding": {
      "start": "step_submit_import",
      "do": ["onboarding_steps", "connect"],
      "finish": "onboarding.complete=true"
    },
    "broker": {
      "start": "quote_tender_book",
      "do": ["quotes", "loads", "docs", "edi"],
      "finish": "booked + invoiced"
    },
    "shipper": {
      "start": "self_serve_quote_order",
      "do": ["shipper_orders", "tracking"],
      "finish": "delivered + paid"
    },
    "carrier": {
      "start": "bid_accept_capacity",
      "do": ["carrier_bids", "capacity", "coi"],
      "finish": "award + on-time delivery"
    },
    "driver": {
      "start": "stop_pod_status",
      "do": ["stop_events", "pod_docs"],
      "finish": "signed POD accepted"
    },
    "owner_operator": {
      "start": "revenue_costs",
      "do": ["settlements", "fleet_costs"],
      "finish": "weekly payout cleared"
    },
    "factoring": {
      "start": "package_submit",
      "do": ["factoring_submissions", "ar_status"],
      "finish": "funded + reconciled"
    },
    "load_board": {
      "start": "post_bid_award",
      "do": ["market_posts", "bids"],
      "finish": "fill rate ≥ target"
    },
    "crm": {
      "start": "account_opp_activity",
      "do": ["accounts", "opportunities"],
      "finish": "win/lose updated"
    },
    "financials": {
      "start": "invoice_ap_gl",
      "do": ["invoices", "ap", "gl_events"],
      "finish": "DSO within target; payouts on time"
    },
    "edi": {
      "start": "204_990_214_210",
      "do": ["edi_messages", "ack_chain"],
      "finish": "no NAKs outstanding"
    },
    "marketplace": {
      "start": "install_webhook",
      "do": ["installations", "webhooks"],
      "finish": "healthy app checks"
    },
    "analytics": {
      "start": "refresh_views",
      "do": "read_materialized_views",
      "finish": "KPIs green or open ticket"
    },
    "autonomous": {
      "start": "queue_dlq_quarantine",
      "do": ["agent_tasks", "agent_logs", "dlq_*"],
      "finish": "success ≥98%, quarantine <1%"
    },
    "workers": {
      "start": "schedule_assign",
      "do": ["work_shifts", "work_assignments"],
      "finish": "backlog under threshold"
    },
    "rates": {
      "start": "instant_price_contract_index",
      "do": ["rate_cards", "indices"],
      "finish": "guardrails OK, margin ok"
    },
    "directory": {
      "start": "verify_kyc_safety",
      "do": ["partners", "verifications"],
      "finish": "partner usable"
    },
    "testing": {
      "start": "test_validate_verify",
      "do": ["test_results", "test_metrics"],
      "finish": "tests pass, coverage maintained"
    }
  },
  "website_events": {
    "conversion_critical": {
      "/roi": {
        "event": "lead.roi_submitted",
        "flow": "score → n8n route → trial/checkout link"
      },
      "/trial": {
        "event": "stripe_entitlements",
        "flow": "Stripe → entitlements → flags on"
      },
      "/checkout": {
        "event": "stripe_session",
        "flow": "session → webhook → plan set"
      },
      "/contact": {
        "event": "lead.contact",
        "flow": "CRM + Slack"
      },
      "/demo": {
        "event": "lead.demo",
        "flow": "CRM + Slack"
      }
    },
    "hubs_content": {
      "features_solutions_resources": {
        "event": "content.view",
        "flow": "UTM enrich → CRM timeline → nurture automations"
      },
      "/resources/api/*": {
        "event": "dev.intent",
        "flow": "open API key draft (flag-gated)"
      }
    },
    "all_pages": {
      "csp": "respect",
      "pii": "no logs",
      "events": "Outbox → n8n for downstream"
    }
  },
  "schedules": {
    "30s": [
      "health_probe",
      "queue_depth",
      "slo_check",
      "throttle_if_breach"
    ],
    "5m": [
      "dlq_retry",
      "max_items": 50,
      "max_size": "2MB",
      "stop_if": ">20% immediate fails"
    ],
    "hourly": [
      "guardrail_drift",
      "index_refresh",
      "etl_ticks"
    ],
    "daily_03_00": [
      "partitions_rotate",
      "ttl_cleanup_30d",
      "budget_reset"
    ],
    "weekly": [
      "dr_drill_dry_run",
      "security_scans",
      "portal_410_drift_audit"
    ],
    "monthly": [
      "restore_test",
      "flag_hygiene",
      "cost_review"
    ]
  },
  "alerts": {
    "page": [
      "outbox_lag_p95_5s_15m",
      "dlq_replay_fail_40_percent",
      "success_95_percent",
      "checkout_error_surge",
      "edi_nak_storm"
    ],
    "warn": [
      "410_hits_50_per_hr_tenant",
      "contract_guardrail_violations",
      "tracking_gaps"
    ],
    "info": [
      "flag_changes",
      "plan_changes",
      "dr_drill_pass"
    ]
  },
  "safety_budgets": {
    "per_tenant": {
      "replays": "enforced via flags",
      "expensive_ops": "enforced via flags"
    },
    "rate_limits": {
      "roi": "10/min",
      "checkout": "5/min",
      "dlq_replay": "3/5m (tenant+IP)"
    },
    "replay_requirements": {
      "v2_signature": true,
      "nonce": true,
      "idempotency_window": "10-min"
    }
  },
  "incident_automations": {
    "slo_breach": [
      "halve_concurrency",
      "disable_canaries",
      "open_incident",
      "attach_runbook_trace_link"
    ],
    "partner_down": [
      "circuit_break",
      "queue_locally",
      "escalate_after_15m"
    ],
    "data_drift": [
      "revert_flag_set",
      "quarantine_new_writes",
      "page_owner"
    ]
  },
  "done_invariants": {
    "every_business_flow": [
      "correct_ledger_entries",
      "audit_log_written",
      "spans_closed_with_status",
      "analytics_updated"
    ],
    "every_external_call": [
      "originates_from_outbox_entry",
      "has_idempotency",
      "either_ack_or_dlq_record"
    ],
    "every_error": [
      "has_trace_link",
      "redacted_context",
      "retry_or_quarantine_disposition"
    ]
  },
  "success_metrics": {
    "operational_excellence": {
      "uptime": "≥99.95%",
      "success_rate": "≥98%",
      "p95_latency": "≤2.5s",
      "quarantine_rate": "<1%"
    },
    "business_metrics": {
      "quote_to_book": "≥85%",
      "on_time_delivery": "≥95%",
      "invoice_accuracy": "≥99%",
      "customer_satisfaction": "≥4.5/5"
    }
  },
  "tasks": [
    {
      "id": "ds-rollout-ui-v2",
      "title": "EXECUTE: Design System Rollout (UI v2) — All Surfaces, Canary + Proofs",
      "priority": "HIGH",
      "status": "READY",
      "created": "2025-08-16T18:55:00.000Z",
      "assigned_to": "TMS_AUTONOMOUS_AGENT_SYSTEM",
      "objective": "Ship the unified Trans Bot AI design system (tokens, components, layouts, accents, states, a11y) to website + 20 portals with UI v2 feature flag, staged rollout, and auditor-ready evidence.",
      
      "guardrails": {
        "slo": {
          "success_rate": "≥ 98%",
          "p95_route_paint": "≤ 2.5s",
          "error_rate": "< 2%"
        },
        "safety_flags": {
          "ui.v2.enabled": "canary",
          "autonomy.emergencyStop": "honor immediately"
        },
        "rollback_triggers": [
          "any portal p95 > 2.5s for 2 consecutive 3-min windows",
          "visual snapshot diff > 5% critical areas"
        ]
      },

      "phases": [
        {
          "id": "phase-0",
          "name": "Setup",
          "target_duration": "1 hour",
          "tasks": [
            "Create tokens & theme",
            "Files: /design/tokens/semantic.json → generate CSS vars to src/styles/tokens.css",
            "Tailwind: extend from tokens; dark mode class-based",
            "Feature flags: Ensure flags exist (idempotent): ui.v2.enabled (global:false), ui.v2.accentMap (JSON), obs.otelEnabled (true)",
            "Component library scaffold: src/components/ui/ (buttons, inputs, cards, tables, overlays, toasts, skeletons, progress)",
            "Docs checkpoint: DESIGN_SYSTEM.md (tokens, components, usage), light/dark screenshots"
          ],
          "deliverable": "PR ui/v2-setup (tests + screenshots)"
        },
        {
          "id": "phase-1",
          "name": "Layout & Navigation Unification",
          "tasks": [
            "Apply app shell to all portals: left rail + top bar + page header presets",
            "Replace inline styles with tokens; remove hardcoded hex values",
            "Introduce state patterns everywhere: Loading: skeleton within 200ms; spinner > 800ms, Empty: icon + sentence + CTA, Error: human message + \"View trace\" (span/traceId)",
            "Accessibility pass (WCAG 2.2 AA basics): Focus rings, aria labels, landmarks, keyboard traversal"
          ],
          "deliverable": "PR ui/v2-shell-portals + axe report"
        },
        {
          "id": "phase-2",
          "name": "Portal Accent Map (sub-brands, subtle)",
          "tasks": [
            "Apply accents only to small affordances (active pill, top-bar indicator, chart series #1)",
            "superAdmin: #8B5CF6, admin: #6366F1, tmsAdmin: #7C3AED, onboarding: #A78BFA",
            "broker: #4F46E5, shipper: #10B981, carrier: #0EA5E9, driver: #F59E0B",
            "ownerOperator: #4338CA, factoring: #16A34A, loadBoard: #06B6D4, crm: #0EA5E9",
            "financials: #14B8A6, edi: #22C55E, marketplace: #8B5CF6, analytics: #D946EF",
            "autonomous: #22D3EE, workers: #10B981, rates: #3B82F6, directory: #64748B"
          ],
          "deliverable": "PR ui/v2-accents (tokenized; no raw hex in components)"
        },
        {
          "id": "phase-3",
          "name": "Data-Viz & Tables",
          "tasks": [
            "Recharts presets (time series with p50/p95 toggle, a11y colors, tz-aware tooltips)",
            "Tables: density toggle, sticky header, sort/filter, empty/error/loading templates",
            "Performance: virtualization where row count > 200"
          ],
          "deliverable": "PR ui/v2-dataviz-tables"
        },
        {
          "id": "phase-4",
          "name": "Website (50+ pages)",
          "tasks": [
            "Apply tokens + components to marketing pages (hero, trust band, features, ROI, CTA)",
            "Lighthouse ≥ 90 on Perf/Best/A11y/SEO (home, pricing, blog index)",
            "SEO tech: meta, OpenGraph, structured data"
          ],
          "deliverable": "PR ui/v2-website"
        },
        {
          "id": "phase-5",
          "name": "Canary, Tests, and Rollout",
          "tasks": [
            "Enable canary: set ui.v2.enabled=true for 10% of sessions/tenants",
            "Visual regression: Playwright snapshots (light/dark) on 20 portal landings",
            "p95 monitor per portal (new SLI event): page paint, TTI, errors",
            "Ramp to 25% → 50% → 100% when green for 30m at each step",
            "If breach → auto-degrade (50% parallelism) → rollback UI v2 flag → open incident"
          ],
          "deliverable": "PR ui/v2-rollout + artifact pack"
        }
      ],

      "evidence_observability": {
        "store_to": "/artifacts/ui-v2/YYYY-MM-DD/",
        "artifacts": [
          "flags.json",
          "lighthouse.json", 
          "axe-report.json",
          "visual-diff.html",
          "p95-portal.csv (per portal)",
          "trace-sample.txt (ids of exemplar spans)"
        ],
        "slack_alert": "includes PR link + traceId + p95 snapshot"
      },

      "acceptance_criteria": {
        "consistency": "tokens only; zero hardcoded colors in app code",
        "a11y": "WCAG 2.2 AA key paths; keyboard-only checks pass",
        "perf": "p95 paint ≤ 2.5s (portal landings & primary dashboards)",
        "seo": "Lighthouse ≥ 90 for website key pages",
        "docs": "DESIGN_SYSTEM.md + kitchen-sink routes: /design-system/components, /design-system/layout"
      },

      "work_items": [
        "ds.tokens.generate",
        "ds.tailwind.apply", 
        "ds.components.ship.core",
        "ds.shell.apply.portals",
        "ds.states.wire",
        "ds.a11y.pass",
        "ds.accents.apply",
        "ds.dataviz.standardize",
        "ds.website.apply",
        "ds.tests.visual",
        "ds.rollout.canary",
        "ds.evidence.capture"
      ],

      "notes_for_agents": [
        "Emit OTEL spans on route mounts and primary actions; attach portalKey, uiVersion: \"v2\"",
        "Respect prefers-reduced-motion",
        "Do not exceed bundle budgets; lazy-load heavy charts/routes",
        "For any portal missing a page, scaffold with v2 components immediately"
      ],

      "operator_quick_checks": [
        "/readyz stays 200; p95 dashboards trending ≤ 2.5s",
        "Visual diffs: no >5% critical changes", 
        "Lighthouse ≥ 90 (home, pricing, blog)",
        "npm run smoke:test && npm run check:portals green"
      ],

      "rollback_procedure": [
        "flip ui.v2.enabled=false globally",
        "revert last PR", 
        "restore prior snapshots"
      ],

      "execution_window": "Safe to run now (honor emergencyStop)",
      "priority": "HIGH"
    },
    {
      "id": "research-mode-enable",
      "title": "ENABLE: Autonomous Research Team — Continuous Self-Improvement",
      "priority": "HIGH",
      "status": "READY",
      "created": "2025-08-16T19:00:00.000Z",
      "assigned_to": "TMS_AUTONOMOUS_AGENT_SYSTEM",
      "objective": "Enable continuous self-improvement across website + 20 portals with safe, measurable experiments via the built-in Research Team.",
      
      "guardrails": {
        "slo": {
          "success_rate": "≥ 98%",
          "p95_route_paint": "≤ 2.5s",
          "error_rate": "< 2%"
        },
        "safety_flags": {
          "autonomy.emergencyStop": "honor immediately",
          "research.mode.enabled": "canary"
        },
        "rollback_triggers": [
          "any experiment causes SLO breach",
          "ethical violation detected",
          "PII exposure risk"
        ]
      },

      "phases": [
        {
          "id": "phase-1",
          "name": "Research Team Activation",
          "target_duration": "30 minutes",
          "tasks": [
            "Activate Research Director role for prioritization and ethics oversight",
            "Activate UX Researcher role for IA, flows, copy, accessibility",
            "Activate Data Scientist role for metrics design and statistical analysis",
            "Activate Performance Engineer role for optimization and monitoring",
            "Activate Experiment Conductor role for A/B testing and rollout management",
            "Activate Documentation Curator role for ADRs, PRDs, and knowledge management"
          ],
          "deliverable": "Research Team operational with defined roles and responsibilities"
        },
        {
          "id": "phase-2",
          "name": "Backlog Creation",
          "target_duration": "1 hour",
          "tasks": [
            "Analyze telemetry data for top 10 improvement opportunities",
            "Map user journeys and identify pain points",
            "Prioritize experiments by potential impact and effort",
            "Create experiment backlog with hypotheses and success metrics",
            "Set up evidence storage structure: /artifacts/research/YYYY-MM-DD/"
          ],
          "deliverable": "Prioritized research backlog with 10+ high-ROI experiments"
        },
        {
          "id": "phase-3",
          "name": "First Three Experiments",
          "target_duration": "2 hours",
          "tasks": [
            "Launch Pricing CTA Clarity experiment (website /pricing)",
            "Launch Portal Tables Virtualization experiment (Broker/Carrier/Analytics)",
            "Launch Form UX Polish experiment (Onboarding/Driver)",
            "Set up monitoring and evidence collection for each experiment",
            "Configure feature flags for safe A/B testing"
          ],
          "deliverable": "Three active experiments with monitoring and evidence collection"
        }
      ],

      "evidence_observability": {
        "store_to": "/artifacts/research/YYYY-MM-DD/",
        "artifacts": [
          "hypotheses.md",
          "experiments.json",
          "p95.csv",
          "funnels.csv",
          "a11y.json",
          "visual-diff.html",
          "traces.txt",
          "rfcs.md",
          "adrs.md"
        ],
        "daily_report": "Generate /artifacts/research/<date>/daily.md with experiment status"
      },

      "acceptance_criteria": {
        "research_team": "All 6 roles activated and operational",
        "backlog": "10+ prioritized experiments with clear hypotheses",
        "experiments": "3 active experiments with monitoring and evidence collection",
        "safety": "All experiments respect SLOs, ethics, and accessibility standards",
        "documentation": "Experiment template and process documentation in place"
      },

      "work_items": [
        "research.team.activate",
        "research.backlog.create",
        "research.experiments.launch.3",
        "research.monitoring.setup",
        "research.evidence.structure",
        "research.documentation.template"
      ],

      "notes_for_agents": [
        "Follow the Research Flywheel: Observe → Hypothesize → Experiment → Learn → Document",
        "Ship via flags/canaries only; never direct production changes",
        "Protect SLOs, keep a11y/ethics intact, prove every improvement with artifacts",
        "Use experiment template from knowledge/03-playbooks/experiment-template.md"
      ],

      "operator_quick_checks": [
        "Research Team roles operational and responding",
        "Backlog created with 10+ experiments",
        "3 experiments active with monitoring",
        "Evidence collection working: /artifacts/research/YYYY-MM-DD/",
        "Daily reports being generated"
      ],

      "rollback_procedure": [
        "flip research.mode.enabled=false globally",
        "pause all active experiments",
        "revert any experimental changes",
        "restore control variants"
      ],

      "execution_window": "Safe to run now (honor emergencyStop)",
      "priority": "HIGH"
    }
  ]
}
